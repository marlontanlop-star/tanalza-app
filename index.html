<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Loop ID - Master Full v4.0</title>
    
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Courier+New&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        :root { 
            --bg-color: #000000; 
            --logo-color: #ffffff; 
            --accent-color: #ffb6c1; 
            --pink-accent: #ffb6c1; 
        }
        
        body { 
            background-color: var(--bg-color); 
            color: #ffffff; 
            font-family: 'Inter', sans-serif; 
            -webkit-font-smoothing: antialiased; 
            overflow-x: hidden; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* NAV CRISTAL */
        .glass-nav { 
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(25px); 
            border-top: 1px solid rgba(255,255,255,0.08); 
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }

        .login-input { 
            background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1); 
            color: white; 
            border-radius: 16px; 
            padding: 18px; 
            width: 100%; 
            outline: none; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        
        .login-input:focus { 
            border-color: var(--accent-color); 
            background: rgba(255,255,255,0.1);
            transform: scale(1.02);
        }

        /* Animaciones SVG Logo Master */
        .stroke-anim { fill: none; stroke: var(--logo-color); stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: drawIn 2.5s ease-out forwards; }
        .loop-capsule { fill: none; stroke: var(--logo-color); stroke-linecap: round; animation: drawIn 3s ease-out forwards; }
        .loop-glow { fill: none; stroke: var(--accent-color); stroke-linecap: round; stroke-dasharray: 50, 150; opacity: 0; animation: rotateGlow 4s linear infinite, fadeIn 2s forwards 2s; }
        .fill-final { fill: rgba(255,255,255,0); animation: fillWhite 1.2s ease-in forwards 1.8s; }
        
        @keyframes drawIn { to { stroke-dashoffset: 0; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes rotateGlow { from { stroke-dashoffset: 200; } to { stroke-dashoffset: 0; } }
        @keyframes fillWhite { to { fill: rgba(255,255,255,1); } }
        
        .fade-in-up { animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(40px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Estilos Mapa Interactivo */
        .country-outline { fill: rgba(255, 255, 255, 0.03); stroke: rgba(255, 255, 255, 0.2); stroke-width: 1; stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: drawPath 4s ease-out forwards; }
        .route-path { fill: none; stroke: rgba(255, 182, 193, 0.1); stroke-width: 1.5; stroke-linecap: round; }
        .travel-glow { fill: none; stroke: var(--pink-accent); stroke-width: 2.5; stroke-linecap: round; stroke-dasharray: 30, 300; stroke-dashoffset: 1000; animation: travelEffect 6s linear infinite; filter: drop-shadow(0 0 8px var(--pink-accent)); }
        .airport-node { fill: var(--pink-accent); }
        .airport-pulse { fill: var(--pink-accent); transform-origin: center; animation: pulseRing 3s ease-out infinite; }
        .iata-code { fill: #fff; font-family: 'Courier New', monospace; font-size: 13px; font-weight: bold; letter-spacing: 2px; opacity: 0; animation: fadeIn 1s forwards 3s; }
        
        @keyframes drawPath { to { stroke-dashoffset: 0; } }
        @keyframes travelEffect { from { stroke-dashoffset: 1000; } to { stroke-dashoffset: 0; } }
        @keyframes pulseRing { 0% { transform: scale(0.6); opacity: 0.9; } 100% { transform: scale(3); opacity: 0; } }

        /* Wallet Cards Design */
        .card-titanium { background: radial-gradient(circle at 0% 0%, #6366f1 0%, #1f2937 40%, #000000 100%); border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .card-evva { background: radial-gradient(circle at 100% 0%, #dc2626 0%, #7f1d1d 50%, #000000 100%); border: 1px solid rgba(239, 68, 68, 0.2); }
        .card-dupass { background: radial-gradient(circle at 50% 0%, #10b981 0%, #064e3b 60%, #000000 100%); border: 1px solid rgba(52, 211, 153, 0.25); }
        
        .modal-titanium { background: radial-gradient(circle at 50% 0%, #312e81 0%, #000000 90%); }
        .modal-evva { background: radial-gradient(circle at 50% 0%, #7f1d1d 0%, #000000 90%); }
        .modal-dupass { background: radial-gradient(circle at 50% 0%, #064e3b 0%, #000000 90%); }

        .buy-sheet { background: linear-gradient(to top, #0a0a0a, #151515); border-radius: 2.5rem 2.5rem 0 0; border-top: 1px solid rgba(255,182,193,0.15); }
        .insta-grid { display: grid; gap: 1.5rem; }
        .profile-upload:hover .overlay { opacity: 1; }
        .nfc-active { animation: nfcPulse 1.2s infinite; }
        @keyframes nfcPulse { 0% { opacity: 0.3; } 50% { opacity: 1; } 100% { opacity: 0.3; } }
    </style>

    <script>
        // --- 1. FIREBASE CONFIGURATION ---
        const firebaseConfig = { 
            apiKey: "AIzaSyCMWlp3Cgagz2MFDd8OIu4XRg9vdxFkEPc", 
            authDomain: "tanalza-app.firebaseapp.com", 
            projectId: "tanalza-app", 
            storageBucket: "tanalza-app.firebasestorage.app", 
            messagingSenderId: "458130807177", 
            appId: "1:458130807177:web:cde4e0d147c937b4542958" 
        };
        
        try { firebase.initializeApp(firebaseConfig); } catch(e) { console.error("Firebase Init Error", e); }
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- 2. GLOBAL STATE ---
        let selectedShopEvent = null;
        let currentUserUID = null;
        let userNameGlobal = "Marlon Tangarife"; //
        let myPurchasedEvents = [];

        // --- 3. SYSTEM BOOT ---
        window.onload = function() {
            loadSavedPhoto();
            auth.onAuthStateChanged((user) => {
                const splash = document.getElementById('splashScreen');
                if (user) {
                    currentUserUID = user.uid;
                    document.getElementById('viewLogin').classList.add('hidden');
                    document.getElementById('appContainer').classList.remove('hidden');
                    initUserData(user.uid);
                } else {
                    currentUserUID = null;
                    document.getElementById('viewLogin').classList.remove('hidden');
                    document.getElementById('appContainer').classList.add('hidden');
                }
                if(splash) { setTimeout(() => { splash.style.opacity = '0'; setTimeout(() => splash.style.display = 'none', 700); }, 2000); }
            });
        };

        // --- 4. AUTHENTICATION ---
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            if(!email || !pass) return;
            showLoader(true);
            auth.signInWithEmailAndPassword(email, pass)
                .then(() => showLoader(false))
                .catch((err) => { showLoader(false); document.getElementById('loginError').classList.remove('hidden'); });
        }

        function handleLogout() { auth.signOut(); }

        // --- 5. DATA MANAGEMENT ---
        function initUserData(uid) {
            // Perfil y Dupas Sincronizadas
            const userRef = db.collection("users").doc(uid);
            userRef.onSnapshot((docSnap) => {
                if (docSnap.exists) {
                    const data = docSnap.data();
                    userNameGlobal = data.name || "Usuario";
                    const balance = (data.dupas || 0).toLocaleString();
                    document.querySelectorAll('#displayDupas, #walletDupaBalance').forEach(el => el.innerText = balance);
                    document.getElementById('displayUserName').innerText = userNameGlobal;
                    document.getElementById('profileUserName').innerText = userNameGlobal;
                    
                    const inv = document.getElementById('statInvested');
                    if(inv && data.invested) inv.innerText = '$' + ((data.invested || 0) / 1000000).toFixed(1) + 'M';
                }
            });

            // Tickets y Reporte de Gastos
            db.collection("tickets").where("userId", "==", uid).onSnapshot((snapshot) => {
                const tickets = [];
                myPurchasedEvents = [];
                const spendingList = document.getElementById('spendingReportList');
                spendingList.innerHTML = ''; // Reiniciar reporte

                snapshot.forEach((doc) => {
                    const t = doc.data();
                    const ticketId = doc.id;
                    tickets.push({ id: ticketId, ...t });
                    myPurchasedEvents.push(t.artist);

                    // Lógica del Reporte de Gastos (Novedad)
                    spendingList.innerHTML += `
                        <div class="flex justify-between items-center p-4 bg-white/5 rounded-2xl border border-white/5 mb-2">
                            <div>
                                <p class="text-white font-bold text-sm">${t.artist}</p>
                                <p class="text-[9px] text-gray-500 uppercase tracking-tighter">${t.venue}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-pink-300 font-mono text-[10px] font-bold">RFID: ...${ticketId.substr(-4).toUpperCase()}</p>
                                <p class="text-[9px] text-gray-600">${t.date}</p>
                            </div>
                        </div>
                    `;
                });
                
                document.querySelectorAll('#ticketCount, #statTicketCount').forEach(el => el.innerText = tickets.length);
                initShopLive();

                const container = document.getElementById('ticketsContainer');
                if (tickets.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-600 py-20 text-xs">Sin accesos activos.</p>';
                    spendingList.innerHTML = '<p class="text-center text-gray-700 py-6 text-[10px]">Sin historial de canje.</p>';
                } else {
                    container.innerHTML = tickets.map(ev => {
                        const bgStyle = ev.image ? `background: url('${ev.image}') center/cover no-repeat;` : `background: linear-gradient(to bottom right, #1f2937, #000000);`;
                        return `
                        <div class="fade-in-up relative aspect-square w-full rounded-[2.5rem] overflow-hidden border border-white/5 shadow-2xl cursor-pointer transition-transform active:scale-95" 
                             style="${bgStyle}" 
                             onclick="openTicket('${ev.artist}', '${ev.venue}', '${ev.date}', '${ev.seat || 'G-00'}', '${ev.image || ''}', '${ev.id}')">
                            <div class="absolute inset-0 bg-black/40"></div>
                            <div class="absolute inset-0 p-6 flex flex-col justify-between z-20">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <span class="text-4xl font-black text-white leading-none tracking-tighter block">${ev.date.split(' ')[0]}</span>
                                        <span class="text-xs font-bold text-white/80 tracking-widest uppercase">${ev.date.split(' ')[1]}</span>
                                    </div>
                                    <div class="bg-black/50 backdrop-blur-md px-3 py-1.5 rounded-xl border border-white/20">
                                        <span class="text-[10px] font-bold text-white">${ev.seat || 'G-01'}</span>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-[10px] font-bold text-white/70 uppercase tracking-[0.2em] mb-1">LOOP MEMBER</p>
                                    <h2 class="text-2xl font-black text-white leading-tight">${ev.artist}</h2>
                                </div>
                            </div>
                        </div>`;
                    }).join('');
                }
            });
        }

        // --- 6. SHOP LOGIC ---
        function initShopLive() {
            const container = document.getElementById('shopContainer');
            if(!container) return;
            db.collection("events").orderBy("order").onSnapshot((snapshot) => {
                let htmlContent = '';
                snapshot.forEach((doc) => {
                    const ev = doc.data();
                    if (myPurchasedEvents.includes(ev.artist)) return;
                    const evString = encodeURIComponent(JSON.stringify(ev));
                    const bgStyle = ev.image ? `background: url('${ev.image}') center/cover no-repeat;` : `background-color: #111;`; 
                    htmlContent += `
                    <div class="fade-in-up w-full h-52 rounded-3xl relative overflow-hidden mb-5 border border-white/10" style="${bgStyle}" onclick="openBuyModal('${evString}')">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
                        <div class="absolute bottom-0 w-full p-5 flex justify-between items-end">
                            <div>
                                <span class="text-[10px] font-bold bg-pink-500/80 text-white px-3 py-1 rounded-full mb-2 inline-block">${ev.date}</span>
                                <h4 class="font-bold text-white text-2xl tracking-tighter">${ev.artist}</h4>
                                <p class="text-xs text-gray-300 flex items-center gap-1"><i class="fas fa-location-dot text-[10px]"></i> ${ev.venue}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-black text-emerald-400">${ev.price}</p>
                                <p class="text-[8px] text-gray-500 font-bold uppercase tracking-widest">Dupas</p>
                            </div>
                        </div>
                        <div class="absolute top-4 right-4 bg-white text-black w-10 h-10 rounded-full flex items-center justify-center shadow-xl">
                            <i class="fas fa-shopping-cart text-sm"></i>
                        </div>
                    </div>`;
                });
                container.innerHTML = htmlContent || '<p class="text-center text-gray-700 py-10 text-xs">Marketplace vacío.</p>';
            });
        }

        // --- 7. MODALS & TOOLS ---
        function openTicket(artist, venue, date, seat, image, rfid) {
            document.getElementById('modalArtist').innerText = artist;
            document.getElementById('modalVenue').innerText = venue;
            document.getElementById('modalDate').innerText = date;
            document.getElementById('modalSeat').innerText = seat;
            document.getElementById('modalRFID').innerText = "ID: " + rfid.toUpperCase();
            document.getElementById('modalUserName').innerText = userNameGlobal.toUpperCase();
            document.getElementById('modalMaxEntry').innerText = "22:00 PM"; // Hora máxima solicitada

            const header = document.getElementById('ticketModalHeaderContainer');
            if(image && image.trim() !== "") { 
                header.style.background = `url('${image}') center/cover no-repeat`; 
                header.style.height = '200px'; 
            } else { 
                header.style.background = 'linear-gradient(to bottom, #27272a, #000000)'; 
                header.style.height = '100px'; 
            }
            
            generateComplexQR();
            document.getElementById('ticketModal').classList.remove('hidden');
        }

        function generateComplexQR() {
            const svg = document.getElementById('complexQrSvg');
            if(!svg) return;
            let content = '';
            // Generación de matriz compleja de 19x19 aleatoria
            for(let i=0; i<19; i++) {
                for(let j=0; j<19; j++) {
                    if ( (i<7 && j<7) || (i>11 && j<7) || (i<7 && j>11) ) continue;
                    if(Math.random() > 0.45) {
                        content += `<rect x="${i*8 + 24}" y="${j*8 + 24}" width="6" height="6" fill="black" />`;
                    }
                }
            }
            // Patrones de anclaje QR
            const drawAnchor = (x, y) => {
                content += `<rect x="${x}" y="${y}" width="48" height="48" stroke="black" stroke-width="6" fill="white"/>`;
                content += `<rect x="${x+12}" y="${y+12}" width="24" height="24" fill="black"/>`;
            };
            drawAnchor(24, 24);   // Arriba Izquierda
            drawAnchor(128, 24);  // Arriba Derecha
            drawAnchor(24, 128);  // Abajo Izquierda
            svg.innerHTML = content;
        }

        function confirmPurchase() {
            if(!selectedShopEvent || !currentUserUID) return;
            showLoader(true);
            const userRef = db.collection("users").doc(currentUserUID);
            userRef.get().then((docSnap) => {
                const currentUser = docSnap.data();
                if (currentUser.dupas < selectedShopEvent.price) { alert("Saldo insuficiente."); showLoader(false); return; }
                const seatCode = `P-${Math.floor(Math.random() * 400) + 1}`;
                userRef.update({ 
                    dupas: currentUser.dupas - selectedShopEvent.price, 
                    invested: (currentUser.invested || 0) + (selectedShopEvent.price * 1000) 
                }).then(() => {
                    db.collection("tickets").add({ 
                        userId: currentUserUID, artist: selectedShopEvent.artist, 
                        date: selectedShopEvent.date, venue: selectedShopEvent.venue, 
                        image: selectedShopEvent.image || "", seat: seatCode, 
                        timestamp: Date.now() 
                    }).then(() => {
                        showLoader(false); closeBuyModal(); switchTab('home'); 
                        alert(`Canje exitoso. Tu asiento es: ${seatCode}`);
                    });
                });
            });
        }

        // --- UI HELPERS ---
        function switchTab(tab) {
            ['viewHome', 'viewWallet', 'viewShop', 'viewProfile'].forEach(id => document.getElementById(id).classList.add('hidden'));
            ['btnHome', 'btnWallet', 'btnShop', 'btnProfile'].forEach(id => { 
                document.getElementById(id).classList.replace('text-white', 'text-gray-600'); 
                document.getElementById(id).classList.replace('text-pink-300', 'text-gray-600'); 
            });
            document.getElementById('view' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('hidden');
            const btn = document.getElementById('btn' + tab.charAt(0).toUpperCase() + tab.slice(1));
            btn.classList.replace('text-gray-600', (tab === 'shop' || tab === 'wallet' ? 'text-pink-300' : 'text-white'));
        }

        function openWalletCard(t) {
            const c = document.getElementById('walletModalContent'), n = document.getElementById('walletCardName'), d = document.getElementById('walletCardDesc');
            c.className = "w-full max-w-sm flex flex-col items-center justify-center p-10 rounded-[3rem] border border-white/10 h-[65vh]";
            if(t==='titanium'){ c.classList.add('modal-titanium'); n.innerText="TITANIUM MEMBER"; d.innerText="CADUCIDAD: 31 DIC 2026"; }
            else if(t==='evva'){ c.classList.add('modal-evva'); n.innerText="TEMPLO EVVA"; d.innerText="CADUCIDAD: 15 JUN 2026"; }
            else { c.classList.add('modal-dupass'); n.innerText="DUPASS PAY"; d.innerText="ESTADO: ACTIVA / GLOBAL"; }
            document.getElementById('walletModal').classList.remove('hidden');
        }

        function openBuyModal(s) {
            const ev = JSON.parse(decodeURIComponent(s)); selectedShopEvent = ev;
            const h = document.getElementById('buyHeader');
            if(ev.image) { h.style.background = `url('${ev.image}') center/cover no-repeat`; h.style.height = '220px'; } else { h.style.background = '#111'; h.style.height = '40px'; }
            document.getElementById('buyArtist').innerText = ev.artist; document.getElementById('buyPrice').innerText = ev.price; document.getElementById('buyDate').innerText = ev.date; document.getElementById('buyDesc').innerText = ev.desc;
            document.getElementById('buyModal').classList.remove('hidden'); setTimeout(() => document.getElementById('buySheetContent').classList.remove('translate-y-full'), 50);
        }

        function closeBuyModal() { document.getElementById('buySheetContent').classList.add('translate-y-full'); setTimeout(() => document.getElementById('buyModal').classList.add('hidden'), 300); }
        function closeTicket() { document.getElementById('ticketModal').classList.add('hidden'); }
        function showLoader(s) { document.getElementById('cloudLoader').classList.toggle('hidden', !s); }
        function handlePhotoUpload(i) { if (i.files && i.files[0]) { const r = new FileReader(); r.onload = function(e) { localStorage.setItem('loopProfilePicV26', e.target.result); updateAllAvatars(e.target.result); }; r.readAsDataURL(i.files[0]); } }
        function loadSavedPhoto() { const s = localStorage.getItem('loopProfilePicV26'); if (s) updateAllAvatars(s); }
        function updateAllAvatars(s) { document.querySelectorAll('.avatar-img').forEach(img => { img.src = s; img.classList.remove('hidden'); }); document.querySelectorAll('.avatar-placeholder').forEach(ph => ph.classList.add('hidden')); }
    </script>
</head>
<body class="pb-36 pt-4">

    <div id="splashScreen" class="fixed inset-0 z-[300] bg-black flex flex-col items-center justify-center transition-opacity duration-700">
        <svg width="320" height="130" viewBox="0 0 500 200">
            <path class="stroke-anim" d="M100 80 V135 H135" stroke-width="8"/>
            <circle class="stroke-anim" cx="160" cy="115" r="22" stroke-width="7"/>
            <rect class="loop-capsule" x="195" y="100" width="135" height="32" rx="16" stroke-width="6"/>
            <rect class="loop-glow" x="195" y="100" width="135" height="32" rx="16" stroke-width="3"/>
            <g class="fill-final">
                <path class="stroke-anim" d="M340 100 V155" stroke-width="8"/>
                <circle class="stroke-anim" cx="360" cy="115" r="22" stroke-width="7"/>
            </g>
        </svg>
        <p class="text-gray-500 text-[9px] tracking-[0.6em] uppercase mt-10 animate-pulse">Iniciando Master Full</p>
    </div>

    <div id="cloudLoader" class="fixed inset-0 z-[250] hidden flex items-center justify-center bg-black/70 backdrop-blur-xl">
        <div class="w-12 h-12 border-4 border-pink-300 border-t-transparent rounded-full animate-spin"></div>
    </div>

    <div id="viewLogin" class="fixed inset-0 z-50 bg-black flex flex-col justify-center items-center p-10 hidden">
        <svg width="220" height="90" viewBox="0 0 500 200" class="mb-14">
            <path d="M100 80 V135 H135" stroke="white" stroke-width="12"/>
            <circle cx="160" cy="115" r="25" stroke="white" stroke-width="10"/>
            <rect x="195" y="100" width="130" height="30" rx="15" stroke="white" stroke-width="9"/>
            <path d="M340 100 V150" stroke="white" stroke-width="12"/>
            <circle cx="360" cy="115" r="25" stroke="white" stroke-width="10"/>
        </svg>
        <input type="email" id="loginEmail" placeholder="ID de Usuario" class="login-input mb-5">
        <input type="password" id="loginPass" placeholder="Código de Acceso" class="login-input mb-10">
        <button onclick="handleLogin()" class="w-full py-5 bg-white text-black font-black rounded-2xl tracking-widest active:scale-95 transition">INGRESAR</button>
        <p id="loginError" class="text-red-500 text-xs mt-6 hidden font-bold">ACCESO DENEGADO</p>
    </div>

    <div id="appContainer" class="hidden">
        <main class="px-5 max-w-lg mx-auto min-h-screen">
            
            <div id="viewHome" class="space-y-8 fade-in-up">
                <header class="flex justify-between items-center pt-4">
                    <div>
                        <svg width="110" height="45" viewBox="0 0 500 200">
                            <path d="M100 80 V135 H135" stroke="white" stroke-width="8"/>
                            <circle cx="160" cy="115" r="20" stroke="white" stroke-width="7"/><rect x="195" y="100" width="130" height="30" rx="15" stroke="white" stroke-width="6"/><path d="M340 100 V150" stroke="white" stroke-width="8"/><circle cx="360" cy="115" r="20" stroke="white" stroke-width="7"/>
                        </svg>
                        <p class="text-[8px] text-gray-500 uppercase tracking-widest ml-4 -mt-1">By TanAlza</p>
                    </div>
                    <div class="text-right">
                        <h2 class="text-xl font-thin text-white" id="displayUserName">...</h2>
                        <div class="flex items-center gap-2 justify-end text-[10px]"><span id="displayDupas" class="font-black text-white">0</span> <span class="text-pink-300 font-bold uppercase tracking-tighter">Dupas</span></div>
                    </div>
                </header>
                <div class="flex items-end justify-between px-2">
                    <h2 class="text-3xl font-black text-white">Accesos</h2>
                    <span class="text-[10px] text-gray-500 font-mono" id="ticketCount">0</span>
                </div>
                <div id="ticketsContainer" class="insta-grid pb-20"></div>
            </div>

            <div id="viewWallet" class="hidden space-y-8 fade-in-up pb-24">
                <h2 class="text-3xl font-black text-white mt-6 px-2">Wallet & NFC</h2>
                <div class="insta-grid">
                    <div class="relative aspect-square card-dupass rounded-[3rem] p-8 shadow-2xl active:scale-95 transition" onclick="openWalletCard('dupass')">
                        <div class="flex flex-col justify-between h-full">
                            <div class="flex justify-between items-start"><i class="fas fa-wifi text-3xl rotate-90 text-emerald-300 nfc-active"></i></div>
                            <div>
                                <h3 class="text-3xl font-black text-white leading-tight">DUPA PASS</h3>
                                <div class="flex items-end gap-2">
                                    <span id="walletDupaBalance" class="text-2xl font-mono text-white">0</span>
                                    <span class="text-[9px] text-emerald-200 uppercase mb-1 font-bold">Saldo Sincronizado</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="relative aspect-square card-titanium rounded-[3rem] p-8 shadow-2xl active:scale-95 transition" onclick="openWalletCard('titanium')">
                        <div class="flex flex-col justify-between h-full">
                            <i class="fas fa-crown text-indigo-300 text-4xl"></i>
                            <div><h3 class="text-2xl font-black text-white">TITANIUM</h3><p class="text-[9px] text-indigo-200 uppercase font-bold tracking-[0.2em]">EXP: 31/12/2026</p></div>
                        </div>
                    </div>
                    <div class="relative aspect-square card-evva rounded-[3rem] p-8 shadow-2xl active:scale-95 transition" onclick="openWalletCard('evva')">
                        <div class="flex flex-col justify-between h-full">
                            <i class="fas fa-fire-flame-curved text-red-400 text-4xl"></i>
                            <div><h3 class="text-2xl font-black text-white">EVVA RED</h3><p class="text-[9px] text-red-300 uppercase font-bold tracking-[0.2em]">EXP: 15/06/2026</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="viewShop" class="hidden space-y-6 pb-20 fade-in-up">
                <div class="p-8 bg-gradient-to-br from-gray-900 via-black to-black rounded-[2.5rem] border border-pink-300/10 mb-8 text-center mt-6">
                    <svg width="180" height="75" viewBox="0 0 500 200" class="mx-auto mb-3">
                        <path d="M100 80 V135 H135" stroke="white" stroke-width="10"/>
                        <circle cx="160" cy="115" r="22" stroke="white" stroke-width="8"/><rect x="195" y="100" width="130" height="30" rx="15" stroke="white" stroke-width="7"/><path d="M340 100 V150" stroke="white" stroke-width="10"/><circle cx="360" cy="115" r="22" stroke="white" stroke-width="8"/>
                    </svg>
                    <p class="text-[10px] text-pink-300 uppercase tracking-[0.5em] font-black">TanAlza Market</p>
                </div>
                <div id="shopContainer" class="space-y-4"></div>
            </div>

            <div id="viewProfile" class="hidden space-y-8 pb-24 fade-in-up">
                <div class="text-center mt-10">
                    <div class="relative w-32 h-32 mx-auto rounded-full border-2 border-pink-300 p-1.5 mb-5 shadow-2xl" onclick="document.getElementById('photoInput').click()">
                        <div class="w-full h-full rounded-full bg-gray-900 overflow-hidden relative">
                            <img class="w-full h-full object-cover hidden avatar-img" src="">
                            <div class="w-full h-full flex items-center justify-center avatar-placeholder"><span class="text-3xl font-black text-white">MT</span></div>
                            <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 transition"><i class="fas fa-camera text-white text-sm"></i></div>
                        </div>
                    </div>
                    <input type="file" id="photoInput" hidden accept="image/*" onchange="handlePhotoUpload(this)">
                    <h2 class="text-3xl font-thin text-white" id="profileUserName">...</h2>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest mt-1">Socio Fundador · TanAlza Group</p>
                    <button onclick="handleLogout()" class="text-[10px] text-red-500 mt-4 uppercase border border-red-900/50 rounded-full px-4 py-1.5">Cerrar Sesión</button>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-900/50 p-6 rounded-[2rem] text-center border border-white/5"><p class="text-gray-500 text-[10px] uppercase mb-1">Tickets</p><p class="text-3xl font-black text-white" id="statTicketCount">0</p></div>
                    <div class="bg-gray-900/50 p-6 rounded-[2rem] text-center border border-white/5"><p class="text-gray-500 text-[10px] uppercase mb-1">Estatus</p><p class="text-lg font-bold text-pink-300">Backstage</p></div>
                </div>
                
                <div class="bg-gray-900/40 p-8 rounded-[2.5rem] border border-white/10 shadow-2xl">
                    <div class="flex justify-between items-center mb-6"><h3 class="text-xs font-black text-white uppercase tracking-[0.2em]">Registro de Consumo</h3><i class="fas fa-receipt text-pink-300"></i></div>
                    <div class="space-y-4 max-h-64 overflow-y-auto no-scrollbar" id="spendingReportList"></div>
                    <div class="mt-6 pt-6 border-t border-white/5 flex justify-between items-center"><p class="text-[9px] text-gray-500 uppercase">Inversión Digital</p><p class="text-2xl font-black text-white" id="statInvested">...</p></div>
                </div>

                <div class="bg-black/40 p-6 rounded-[2.5rem] border border-white/5 h-72 flex justify-center relative overflow-hidden">
                    <svg viewBox="0 0 800 500" class="w-full h-full opacity-60">
                        <path class="country-outline" d="M150 140 L240 170 L260 250 L180 230 L130 180 Z" /> <path class="country-outline" d="M340 310 L430 290 L490 310 L460 390 L390 460 L310 410 Z" /> 
                        <g>
                            <path class="route-path" d="M210 200 Q 280 250, 360 330" fill="none" stroke-width="2"/>
                            <path class="travel-glow" d="M210 200 Q 280 250, 360 330" fill="none"/>
                        </g>
                        <g transform="translate(210, 200)"><circle class="airport-pulse" r="5"/><circle class="airport-node" r="4"/><text class="iata-code" x="-50" y="5">MEX</text></g>
                        <g transform="translate(360, 330)"><circle class="airport-pulse" r="5"/><circle class="airport-node" r="4"/><text class="iata-code" x="15" y="5">COL</text></g>
                    </svg>
                    <p class="absolute bottom-6 text-[8px] text-gray-600 tracking-widest uppercase">Global Travel Mapping v26</p>
                </div>
            </div>
        </main>

        <nav class="fixed bottom-0 w-full glass-nav pb-10 pt-5 px-14 flex justify-between items-center z-50">
            <button onclick="switchTab('home')" id="btnHome" class="text-white text-3xl transition active:scale-90"><i class="fas fa-ticket-alt"></i></button>
            <button onclick="switchTab('wallet')" id="btnWallet" class="text-gray-600 text-3xl transition active:scale-90"><i class="fas fa-wallet"></i></button>
            <button onclick="switchTab('shop')" id="btnShop" class="text-gray-600 text-3xl transition active:scale-90"><i class="fas fa-shopping-cart"></i></button>
            <button onclick="switchTab('profile')" id="btnProfile" class="text-gray-600 text-3xl transition active:scale-90"><i class="fas fa-user-circle"></i></button>
        </nav>
    </div>

    <div id="ticketModal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-6 bg-black/98 backdrop-blur-2xl">
        <div id="ticketModalContent" class="w-full max-w-sm bg-black border border-white/10 rounded-[3rem] overflow-hidden flex flex-col h-[85vh] shadow-[0_0_60px_rgba(255,182,193,0.1)]">
            <div id="ticketModalHeaderContainer" class="w-full relative">
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black"></div>
                <div class="absolute top-6 left-0 right-0 text-center"><p class="text-[8px] text-white/50 tracking-[0.5em] uppercase">Security Ticket v.26</p></div>
            </div>
            <div class="p-8 overflow-y-auto no-scrollbar flex-1 text-center">
                <h2 class="text-3xl font-black text-white mb-1" id="modalArtist">...</h2>
                <p class="text-pink-300 text-sm font-bold mb-8 uppercase tracking-widest" id="modalVenue">...</p>
                
                <div class="relative w-56 h-56 mx-auto mb-8 bg-white rounded-3xl flex items-center justify-center p-3 shadow-[0_0_30px_rgba(255,255,255,0.1)]">
                    <svg id="complexQrSvg" width="100%" height="100%" viewBox="0 0 200 200"></svg>
                    <div class="absolute bg-white p-2 rounded-xl border-2 border-pink-100 shadow-sm"><i class="fas fa-shield-halved text-pink-300"></i></div>
                </div>

                <div class="grid grid-cols-2 gap-y-8 gap-x-6 text-left border-t border-white/10 pt-8">
                    <div><p class="text-gray-500 uppercase text-[9px] tracking-[0.2em] mb-1">Titular</p><p class="text-white font-black text-xs" id="modalUserName"></p></div>
                    <div><p class="text-gray-500 uppercase text-[9px] tracking-[0.2em] mb-1">Asiento</p><p class="text-white font-black text-xs" id="modalSeat"></p></div>
                    <div><p class="text-gray-500 uppercase text-[9px] tracking-[0.2em] mb-1">Fecha</p><p class="text-white font-black text-xs" id="modalDate"></p></div>
                    <div><p class="text-gray-500 uppercase text-[9px] tracking-[0.2em] mb-1">Ingreso Máx</p><p class="text-pink-300 font-black text-xs" id="modalMaxEntry"></p></div>
                </div>
                <p class="mt-10 text-[9px] font-mono text-gray-700 tracking-widest" id="modalRFID">RFID: ---</p>
                <button onclick="closeTicket()" class="mt-10 py-4 px-12 rounded-full bg-white text-black font-black text-xs uppercase tracking-[0.3em] active:scale-95 transition">CERRAR</button>
            </div>
        </div>
    </div>

    <div id="walletModal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-8 bg-black/95" onclick="this.classList.add('hidden')">
        <div id="walletModalContent" class="text-center shadow-2xl">
            <h2 id="walletCardName" class="text-4xl font-black text-white mb-3 tracking-tighter"></h2>
            <p id="walletCardDesc" class="text-pink-300 font-black tracking-[0.3em] text-[10px] uppercase"></p>
            <div class="mt-16 p-10 rounded-full border-2 border-white/10 inline-block animate-pulse relative">
                <div class="absolute inset-0 bg-white/5 rounded-full scale-125"></div>
                <i class="fas fa-wifi text-5xl text-white rotate-90"></i>
            </div>
            <p class="text-white/20 text-[9px] mt-8 tracking-[0.5em] uppercase">Proximity NFC Active</p>
        </div>
    </div>

    <div id="buyModal" class="fixed inset-0 z-[180] hidden">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="closeBuyModal()"></div>
        <div id="buySheetContent" class="absolute bottom-0 w-full buy-sheet translate-y-full transition-transform duration-500 p-10">
            <div id="buyHeader" class="w-full rounded-3xl mb-8"></div>
            <div class="flex justify-between items-start mb-6"><h2 class="text-4xl font-black text-white tracking-tighter leading-none" id="buyArtist"></h2><div class="text-right"><p class="text-2xl font-black text-pink-300" id="buyPrice"></p><p class="text-[9px] text-gray-500 uppercase font-bold">Dupas</p></div></div>
            <p class="text-emerald-400 font-black text-xs mb-6 uppercase tracking-widest" id="buyDate"></p>
            <div class="bg-white/5 p-6 rounded-3xl border border-white/5 mb-8"><p class="text-gray-400 text-sm leading-relaxed" id="buyDesc"></p></div>
            <button onclick="confirmPurchase()" class="w-full py-5 bg-white text-black rounded-2xl font-black text-lg tracking-widest active:scale-95 transition">CANJEAR AHORA</button>
        </div>
    </div>

</body>
</html>
